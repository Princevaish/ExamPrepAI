{% extends "account/base.html" %}
{% load i18n %}

{% block head_title %}{% trans "Change Password" %}{% endblock %}

{% block content %}

<div class="text-center mb-4">
  <div class="mb-4">
    <i class="bi bi-key" style="font-size: 4rem; color: #00ffff; filter: drop-shadow(0 0 20px rgba(0, 255, 255, 0.6));"></i>
  </div>
  <h3 class="text-white-soft mb-3">
    {% if token_fail %}
      {% trans "Invalid Reset Link" %}
    {% else %}
      {% trans "Set New Password" %}
    {% endif %}
  </h3>
  <p class="text-muted-custom">
    {% if token_fail %}
      {% trans "This password reset link is invalid or has expired" %}
    {% else %}
      {% trans "Enter your new password below" %}
    {% endif %}
  </p>
</div>

{% if token_fail %}

  <div class="alert alert-danger mb-4" role="alert">
    <i class="bi bi-exclamation-triangle me-2"></i>
    {% url 'account_reset_password' as passwd_reset_url %}
    {% blocktrans %}The password reset link was invalid, possibly because it has already been used. Please request a <a href="{{ passwd_reset_url }}">new password reset</a>.{% endblocktrans %}
  </div>

  <a href="{% url 'account_reset_password' %}" class="btn btn-neon w-100">
    {% trans "Request New Reset Link" %}
  </a>

{% else %}

  <form method="post" action="{{ action_url }}">
    {% csrf_token %}

    {% if form.non_field_errors %}
      <div class="alert alert-danger mb-3" role="alert">
        {{ form.non_field_errors }}
      </div>
    {% endif %}

    <div class="mb-3">
      <label for="{{ form.password1.id_for_label }}" class="form-label">
        {% trans "New Password" %}
      </label>
      <input type="password" 
             name="{{ form.password1.name }}" 
             class="form-control {% if form.password1.errors %}is-invalid{% endif %}"
             id="{{ form.password1.id_for_label }}"
             placeholder="Enter new password"
             required
             autofocus>
      {% if form.password1.errors %}
        <div class="invalid-feedback">
          {{ form.password1.errors }}
        </div>
      {% endif %}
      {% if form.password1.help_text %}
        <small class="form-text text-muted-custom">{{ form.password1.help_text }}</small>
      {% endif %}
    </div>

    <div class="mb-4">
      <label for="{{ form.password2.id_for_label }}" class="form-label">
        {% trans "Confirm New Password" %}
      </label>
      <input type="password" 
             name="{{ form.password2.name }}" 
             class="form-control {% if form.password2.errors %}is-invalid{% endif %}"
             id="{{ form.password2.id_for_label }}"
             placeholder="Confirm new password"
             required>
      {% if form.password2.errors %}
        <div class="invalid-feedback">
          {{ form.password2.errors }}
        </div>
      {% endif %}
    </div>

    <button type="submit" class="btn btn-neon w-100">
      {% trans "Change Password" %}
    </button>

  </form>

{% endif %}

<div class="text-center mt-4">
  <a href="{% url 'account_login' %}" class="text-muted-custom small">
    {% trans "Back to Sign In" %}
  </a>
</div>

{% endblock %}